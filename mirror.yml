.repo_pull_sync:
  image: ghcr.io/hexa-forge/git-sync:latest
  script:
    - export VAULT_ADDR=$VAULT_SERVER_URL
    - export VAULT_TOKEN="$(vault write -field=token auth/jwt/login role=default-ci jwt=$CI_JOB_JWT)"
    - export GIT_INPUT_USER=`vault kv get -field=GIT_INPUT_USER ${VAULT_KV}/${CI_PROJECT_NAMESPACE}/${CI_PROJECT_NAME}`
    - export GIT_INPUT_PASSWORD=`vault kv get -field=GIT_INPUT_PASSWORD ${VAULT_KV}/${CI_PROJECT_NAMESPACE}/${CI_PROJECT_NAME}`
    - export GIT_INPUT_URL=`vault kv get -field=GIT_INPUT_URL ${VAULT_KV}/${CI_PROJECT_NAMESPACE}/${CI_PROJECT_NAME}`
    - export GIT_OUTPUT_USER=`vault kv get -field=GIT_OUTPUT_USER ${VAULT_KV}/${CI_PROJECT_NAMESPACE}/${CI_PROJECT_NAME}`
    - export GIT_OUTPUT_PASSWORD=`vault kv get -field=GIT_OUTPUT_PASSWORD ${VAULT_KV}/${CI_PROJECT_NAMESPACE}/${CI_PROJECT_NAME}`
    - export GIT_OUTPUT_URL=`vault kv get -field=GIT_OUTPUT_URL ${VAULT_KV}/${CI_PROJECT_NAMESPACE}/${CI_PROJECT_NAME}`
    - git clone "https://${GIT_INPUT_USER}:${GIT_INPUT_PASSWORD}@${GIT_INPUT_URL}" ./clonerepo
    - cd clonerepo
    - git checkout ${GIT_BRANCH_DEPLOY}
    - git push --prune "https://${GIT_OUTPUT_USER}:${GIT_OUTPUT_PASSWORD}@${GIT_OUTPUT_URL}" -f
